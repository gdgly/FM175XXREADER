2019年1月16日
增加点钞与复合指示灯
蓝牙断开时,两指示灯常亮
点钞忙时,点钞灯常亮;空闲时闪烁
复合忙时,复合灯常亮;空闲时闪烁

2018年12月18日
增加贵阳改造的币袋箱,备用卡中ID是卡的UID时,不清车牌号,并不外发给平板,等写入周转卡时才发给平板

2018年12月13日
串口参数写初值
定时器中串口输出字符串去除

2018年12月11日
P1.6改为强上拉

2018年12月8日
改为长春"直接盒"

2018年12月6日
修改串口应答时的版本号

2018年12月4日
FM17xx复位改为P1.6与P3.3均复位,支持1.0与1.1以上版本

2018年11月27日
将FM11xx数据0改为0x7e,数据全为0时CRC也为0,可能全误开币胆

2018年11月26日
无线数据增加CRC16 8005

2018年11月21日
17xx与11xx分开关闭,避免选读到17xx后被平板关闭了11xx而不开箱
收到11xx  时延时一会再读数据,
读rxbuf[0]==0x03增加rxbuf[31]==0x03

2018年11月14日
修改开箱时用启类型搞反
增加看门狗
调整FM17xx复位引脚,(之前当作中断输出脚了)

2018年11月12日
增加点钞用户类型

2018年11月10日
将"箱后蓝牙开箱器自动关闭"取消
增加点钞经理卡发数据给平板

2018年11月9日
增加卡类型判断
增加开箱使能
1.	蓝牙开箱器开机默认为关闭状态
2.	在蓝牙每一次连接后,平板发送开启命令
//3.	开箱后蓝牙开箱器自动关闭
4.	平板上点提交数据成功后再次发送开启命令
5.	蓝牙断开连接后,开箱器自动变为关闭状态
6.	蓝牙连接状态,可以用经理卡打开一次

2018年10月8日
改M1卡为A密码

2018年10月7日
改默认为蓝牙周

2018年9月13日
增加串口设置开箱命令
//1e 60 0a 01 06 01 00 09 6f 00 06 d6 b1 bd d3 ba d0 71 1f //直接盒
//1e 60 0a 01 06 01 00 09 6f 00 06 c0 b6 d1 c0 d6 dc 00 1f //蓝牙周

2018年9月11日
增加蓝牙初始化函数
修改连续读不同的块可以出错的问题,增加读N块函数(可跨块,可跨区)
发送的数据有车牌号.币胆ID.司机名,数据以FM11NC08为优先
蓝牙连接成功第5秒发一次数据,直到收到正确应答
SPI中增加超时,  ................还有点问题


//1E 60 01 0A 08 04 00 20 28 00 08 B9 F3 41 30 30 30 31 32 3C 00 07 F4 06 83 79 06 66 C2 20 00 08 C8 F0 B7 E5 B9 AB CB BE F5 1F
//1E 60 01 0A 08 03 00 21 28 00 09 BC AA 41 50 30 30 32 30 44 3C 00 07 F4 06 83 79 06 66 C2 20 00 08 C8 F0 B7 E5 B9 AB CB BE 8B 1F



# CPU卡操作

* 寻卡-防冲突-选卡-ATS 发RATS初始化CPU卡 
``` bash
BYTE0           - 10 巡卡命令
发送：10
返回：00107880900220900000000000B0DCBD2F
```

* 选择 MF
``` bash
BYTE0           - 62 选择PICC目录命令
BYTE1 ~ BYTE2   - 3F00 目录名 选择了MF根目录
发送：623F00
返回：000A016F15840E315041592E5359532E4444463031A5038801019000
```

* 认证
``` bash
BYTE0           - 63 外部认证命令
BYTE1           - 密钥标识00,即放在MF下密钥文件里面的密钥
BYTE2           - 默认秘钥FFFFFFFFFFFFFFFF
发送：6300FFFFFFFFFFFFFFFF  // 默认秘钥
发送：63000102030405060708  // 如果修改了秘钥0102030405060708
返回：00
```

* 删除MF下的所有文件
``` bash
BYTE0           - 64 删除MF下的DF指令
发送：64
返回：00
```

* 建立文件 注意：在做了擦除所有DF文件后，这密钥文件必须首先建立。
``` bash
BYTE0           - 65 建立密钥文件指令
BYTE1 ~ BYTE2   - 文件标识
BYTE3           - 文件类型
                        | -- 3F - KEY文件类型
                        | -- 28 - 二进制文件类型
                        | -- 2A - 定长文件
                        | -- 2E - 循环记录
                        | -- 2F - 钱包记录文件
                        | -- 2C - 边长记录
BYTE4 ~ BYTE5   - 文件长度
BYTE6           - 文件读权限
BYTE7           - 文件写权限
BYTE8 ~ BYTE9   - 保留
例子
BYTE3 ~ BYTE9  - 3F00B001F0FFFF 密钥文件
BYTE3 ~ BYTE9  - 28010001F0FFFF 二进制文件

发送：6500003F00B001F0FFFF 创建秘钥文件
发送：653F01380520F0F095FFFF4444463031 创建DF目录
发送：6500052801FFF0F0FFFF 创建二进制文件
返回：00
```

* 设置MF秘钥
``` bash
BYTE0           - 66 设置秘钥命令
BYTE1 ~ BYTE5   - 39F0F0AAFF 外部密钥建立的指令信息
BYTE6 ~ BYTE14  - 0102030405060708
发送：
6639F0F0AAFF0102030405060708 // 0102030405060708可新修改密码
6639F0F0AAFFFFFFFFFFFFFFFFFF // FFFFFFFFFFFFFFFF为卡出厂默认密码
返回：00
```

* 跟新文件
``` bash
BYTE0           - 67 跟新写文件
BYTE1           - 起始地址高位  注意，高8位不能为1，P1的有效地址为0X7F
BYTE2           - 起始地址低位  P2的有效地址为0XFF
BYTE3           - 长度
BYTE4 ~ BYTEn   - 写入的数据
发送：67000006665544332211
返回：00
```

* 读文件
``` bash
BYTE0           - 68 跟新写文件
BYTE1           - 起始地址高位  注意，高8位不能为1，P1的有效地址为0X7F
BYTE2           - 起始地址低位  P2的有效地址为0XFF
BYTE3           - 读取的长度
发送：68000006
返回：0A01665544332211
```
